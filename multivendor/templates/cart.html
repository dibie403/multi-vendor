
{% extends "layout.html" %}

{% block content3 %}
<h2 class="mb-0">Cart/Checkout Info</h2>
<small class="text-muted">Only Items you cart From This Seller Store Is Displayed Here</small>
<div class="content-section mb-2">
    {% if cart_count != 0 %}
    <h6 class=" mb-2 sub">No. of items ( {{ cart_count }} )</h6>
    {% endif %}
      <div>
        <div class="row product-grid">
          {% for cart_item in cart_items %}
         <!-- Product Item -->
            <div class="col-6 col-sm-4 col-md-2 product-item" data-toggle="modal" data-target="#productModal{{ cart_item.product.id }}">
                <div class="product-card">
                    <div class="image-container">
                        <img src="{{ url_for('static', filename='product_images/' + cart_item.product.image) }}" class="card-img-top" alt="{{cart_item.product.name }}">
                        
                    </div>
                    <div class="card-body text-center">
                        <small class="card-title">{{ cart_item.product.name }}</small>
                        <p class="card-text price">${{cart_item.product.amount }}</p>
                    </div>
                </div>
            </div>
           

            <!-- Product Modal -->
            <div class="modal fade" id="productModal{{cart_item.product.id }}" tabindex="-1" role="dialog" aria-labelledby="productModalLabel{{ cart_item.product.id }}" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                        	<a href="{{ url_for('delete_cart_item',product_id=cart_item.product_id,seller_id=cart_item.seller_id) }}"class="btn btn-outline-danger btn-sm mx-1 ">
					                    <img src="{{ url_for('static', filename='images/trash.png') }}" alt="delete Product" style="width: 12px;">
					        </a>
                            <h5 class="modal-title">{{ cart_item.product.name }}</h5>

                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body text-center">
                            <img src="{{ url_for('static', filename='product_images/' + cart_item.product.image) }}" class="img-fluid mb-3" alt="{{ cart_item.product.name }}">
                            <p>{{ cart_item.product.description }}</p>
                            <p class="price">N{{ cart_item.product.amount }}</p>
                            <strong >QTY: {{cart_item.quantity}} </strong>

                            
                            
                        </div>
                    </div>
                </div>
            </div>
            <!--<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
			  <div class="modal-dialog" role="document">
			    <div class="modal-content">
			      <div class="modal-header">
			        <h5 class="modal-title" id="deleteModalLabel">Are you Sure You Want To Delete This Product</h5>
			        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
			          <span aria-hidden="true">&times;</span>
			        </button>
			      </div>
			      <div class="modal-body">
			        clicking on the delete button will completely remove this item from your cart!
			      </div>
			      <div class="modal-footer">
			        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
			        <a href="{{ url_for('delete_cart_item',product_id=cart_item.product_id,seller_id=cart_item.seller_id) }}" class="btn btn-primary btn btn-sm-2">Delete</a>
			      </div>
			    </div>
			  </div>
			</div>-->

            <!-- âœ… Order Success Modal -->
            <div class="modal fade" id="orderSuccessModal" tabindex="-1" role="dialog" aria-labelledby="orderSuccessLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content text-center">
                        <div class="modal-body">
                            <!-- âœ… Your Animation Video -->
                            <video autoplay loop muted width="250">
                                <source src="{{ url_for('static', filename='images/large-thumbnail20250215-1141279-107uma8.mp4') }}" type="video/mp4">
                                Your browser does not support the video tag.
                            </video>

                            <h4 class="mt-3 text-success">Order Placed Successfully!</h4>
                            <p>Your order has been placed and is being processed.</p>

                            {% if track_code and seller_id %}
                                <!-- âœ… WhatsApp Button -->
                                <a href="{{ url_for('send_order_whatsapp', seller_id=seller.id, track_code=track_code) }}" class="btn btn-success mt-3">
                                    <i class="bi bi-whatsapp"></i> Notify Vendor
                                </a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
            
        {% else %}
         <h3 class=" text-center">No cart Items Yet!</h3>
    {% endfor %}
    
</div>

{% for page_num in range(1, total_pages + 1) %}
    {% if page == page_num %}
        <a class="btn btn-info mb-4" href="{{ url_for('cart', seller_id=seller.id, page=page_num) }}">{{ page_num }}</a>
    {% else %}
        <a class="btn btn-outline-info mb-4" href="{{ url_for('cart', seller_id=seller.id, page=page_num) }}">{{ page_num }}</a>
    {% endif %}
{% endfor %}

{% if cart_count == 0 %}
        <form>
            <div class="d-flex gap-3 mt-3">
                <button type="button" class="btn btn-warning disabled">
                    Checkout  {{ cart_count }} itemsðŸ›’
                </button>
            </div>
        </form>
{% else %}
<form id="checkoutForm" action="{{ url_for('checkout', seller_id=seller.id,track_code=track_code) }}" method="POST">
                        <div class="d-flex gap-3 mt-3">
                            <button type="button" class="btn btn-warning btn-block" id="placeOrderBtn">
                                Checkout ( Total cost: N{{total_amount}} )
                            </button>
                        </div>
                    </form>
{% endif %}


<script>
    document.getElementById("placeOrderBtn").addEventListener("click", function (event) {
    event.preventDefault();  // â›” Prevent the default form submission

    let form = document.getElementById("checkoutForm");
    let formData = new FormData(form);

    fetch(form.action, {
        method: "POST",
        body: formData
    })
    .then(response => response.text())  // Handle response if needed
    .then(data => {
        console.log("Order placed:", data);

        // âœ… Show success modal after form submission
        $("#orderSuccessModal").modal("show");
    })
    .catch(error => console.error("Error:", error));
});


    // âœ… Update WhatsApp Button with Track Code
    document.addEventListener("DOMContentLoaded", function () {
        let trackCode = "{{ request.args.get('track_code', '') }}";  // Get track code from URL
        let sellerId = "{{ seller_id }}";  // Seller ID

        if (trackCode) {
            let whatsappUrl = `{{ url_for('send_order_whatsapp', seller_id=0, track_code="TRACK_CODE") }}`.replace("0", sellerId).replace("TRACK_CODE", trackCode);
            document.getElementById("whatsappBtn").setAttribute("href", whatsappUrl);
        }
    });
    
</script>

{% endblock %}