{% extends "layout.html" %}

{% block content3 %}
  <div class="content-section11 mb-4">
    <!-- Top Section: Go Back Link & Icons -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <!-- Go Back Link -->
        <a href="javascript:history.back()" class="btn btn-outline-secondary btn-sm">Go Back</a>
        
        {% if current_user.username == product.seller.username %}
        <!-- Icon Buttons -->
            <div class="d-flex justify-content-end">
               

                <a class="btn btn-outline-danger btn-sm mx-1" data-toggle="modal" data-target="#deleteModal">
                    <img src="{{ url_for('static', filename='images/trash.png') }}" alt="delete Product" style="width: 12px;">
                </a>

                <a href="{{ url_for('edit_product',product_id=product.id) }}" class="btn btn-outline-success btn-sm mx-1">
                    <img src="{{ url_for('static', filename='images/edit.png') }}" alt="Settings" style="width: 12px;">
                </a>
            </div>
        {% else %}
         <a class="btn btn-outline-danger btn-sm mx-1" data-toggle="modal" data-target="#deleteModal">
                    <img src="{{ url_for('static', filename='images/trash.png') }}" alt="delete Product" style="width: 12px;">
                </a>

        {% endif %}

    </div>

    <div class="product-container">
        <!-- Image Slider -->
        <div class="d-flex justify-content-center mb-3">
            <img src="{{ url_for('static', filename='product_images/' + product.image) }}" class="product-image img-fluid" alt="Product Image">
        </div>

        <!-- Product Details -->
        <div class="product-details">
            <p class="sku">SKU: 00{{product.id}}</p>
            <h1 class="card-title">{{product.name}}</h1>
            <p class="price">${{product.amount}}</p>

            <!-- Color Selection -->
            <div class="card-title">
                <p>Description: <span style="color:grey;">{{product.description}}</span></p>
                <div class="color-option selected"></div>
            </div>

           <form action="{{ url_for('Cart_product', product_id=product.id) }}" method="POST">
                <!-- Quantity Selector -->
                <div class="d-flex align-items-center gap-3 mt-3">
                    <label for="quantity">Quantity:</label>

                    <div class="quantity-container d-flex align-items-center">
                        <button type="button" class="btn-quantity" onclick="decreaseQuantity()">âˆ’</button>
                        <input type="number" id="quantity" name="quantity" min="1" value="1">
                        <button type="button" class="btn-quantity" onclick="increaseQuantity()">+</button>
                    </div>
                </div>

                <!-- Submit Button -->
                <button type="submit" class="btn-add-cart">Add to cart ðŸ›’</button>
            </form>



        </div>
    </div>

    <!-- Buttons -->
            <form id="checkoutForm" action="{{ url_for('checkout', seller_id=product.user_id,track_code=track_code) }}" method="POST">
                <div class="d-flex gap-3 mt-3">
                    <button type="button" class="btn btn-warning" id="placeOrderBtn">
                        Place Order {{ cart_count }} ðŸ›’
                    </button>
                </div>
            </form>
  </div>

 </div>
<div class="modal fade" id="deleteModal" tabindex="-1" role="dialog" aria-labelledby="deleteModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="deleteModalLabel">Are you Sure You Want To Delete This Product</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        clicking on the delete button will completely remove this item fromyour store!
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <a href="{{ url_for('delete_product',product_id=product.id) }}" class="btn btn-primary btn btn-sm-2">Delete</a>
      </div>
    </div>
  </div>
</div>

<!-- âœ… Order Success Modal -->
<div class="modal fade" id="orderSuccessModal" tabindex="-1" role="dialog" aria-labelledby="orderSuccessLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content text-center">
            <div class="modal-body">
                <!-- âœ… Your Animation Video -->
                <video autoplay loop muted width="250">
                    <source src="{{ url_for('static', filename='images/large-thumbnail20250215-1141279-107uma8.mp4') }}" type="video/mp4">
                    Your browser does not support the video tag.
                </video>

                <h4 class="mt-3 text-success">Order Placed Successfully!</h4>
                <p>Your order has been placed and is being processed.</p>

                {% if track_code and seller_id %}
                    <!-- âœ… WhatsApp Button -->
                    <a href="{{ url_for('send_order_whatsapp', seller_id=seller_id, track_code=track_code) }}" class="btn btn-success mt-3">
                        <i class="bi bi-whatsapp"></i> Notify Vendor
                    </a>
                {% endif %}
            </div>
        </div>
    </div>
</div>








<script>
let currentIndex = 0;
const images = document.querySelectorAll('.slides img');
const dots = document.querySelectorAll('.dot');

function changeSlide(index) {
    images[currentIndex].classList.remove('active');
    dots[currentIndex].classList.remove('active');

    images[index].classList.add('active');
    dots[index].classList.add('active');

    currentIndex = index;
}

function increaseQuantity() {
    let quantityInput = document.getElementById("quantity");
    quantityInput.value = parseInt(quantityInput.value) + 1;
}

function decreaseQuantity() {
    let quantityInput = document.getElementById("quantity");
    if (parseInt(quantityInput.value) > 1) {
        quantityInput.value = parseInt(quantityInput.value) - 1;
    }
}


document.getElementById("placeOrderBtn").addEventListener("click", function (event) {
    event.preventDefault();  // â›” Prevent the default form submission

    let form = document.getElementById("checkoutForm");
    let formData = new FormData(form);

    fetch(form.action, {
        method: "POST",
        body: formData
    })
    .then(response => response.text())  // Handle response if needed
    .then(data => {
        console.log("Order placed:", data);

        // âœ… Show success modal after form submission
        $("#orderSuccessModal").modal("show");
    })
    .catch(error => console.error("Error:", error));
});


    // âœ… Update WhatsApp Button with Track Code
    document.addEventListener("DOMContentLoaded", function () {
        let trackCode = "{{ request.args.get('track_code', '') }}";  // Get track code from URL
        let sellerId = "{{ product.user_id }}";  // Seller ID

        if (trackCode) {
            let whatsappUrl = `{{ url_for('send_order_whatsapp', seller_id=0, track_code="TRACK_CODE") }}`.replace("0", sellerId).replace("TRACK_CODE", trackCode);
            document.getElementById("whatsappBtn").setAttribute("href", whatsappUrl);
        }
    });
</script>


{% endblock %}
